@attribute [Authorize(AhlanFeekumPermissions.PropertyMedias.Default)]
@using AhlanFeekum.PropertyMedias
@using AhlanFeekum.Permissions;
@using Microsoft.AspNetCore.Authorization
@using Microsoft.Extensions.Localization
@using Microsoft.AspNetCore.Components.Web
@using Blazorise
@using Blazorise.Components
@using Blazorise.DataGrid
@using Volo.Abp.BlazoriseUI
@using Volo.Abp.BlazoriseUI.Components
@using Volo.Abp.ObjectMapping
@using Volo.Abp.AspNetCore.Components.Messages
@using Volo.Abp.AspNetCore.Components.Web.Theming.Layout
@using Microsoft.AspNetCore.Components
@using Volo.Abp.AspNetCore.Components.Web
@using Volo.Abp.Http.Client
@inherits AhlanFeekumComponentBase
@inject IPropertyMediasAppService PropertyMediasAppService
@inject IUiMessageService UiMessageService
@inject IRemoteServiceConfigurationProvider RemoteServiceConfigurationProvider
@inject NavigationManager NavigationManager



<Card>

    <CardBody>
        <Validations @ref="@PropertyMediaValidations"
                     Mode="ValidationMode.Auto"
                     Model="@PropertyMedia"
                     ValidateOnLoad="false">


            <Field>
                <FieldLabel>@L["Image"]</FieldLabel>
                <Row>
                    <Column ColumnSize="ColumnSize.Is11">
                        <FilePicker Multiple Changed="FileChanged" Upload="OnFileUpload" ShowMode="FilePickerShowMode.List" />
                    </Column>
                    <Column ColumnSize="ColumnSize.Is1">
                        <Button Color="Color.Primary" Clicked="async () => await RemovePropertyMedia()">@L["Reset"]</Button>
                    </Column>
                </Row>

                @if (PropertyMedia.FileNewUpload && !PropertyMedia.Image.IsNullOrEmpty() && !PropertyMedia.FileContent.IsNullOrEmpty())
                {
                    <div style="width:256px;height:256px;background-size:100% 100%; background-repeat:no-repeat; background-image:url(@($"data:{MimeTypes.MimeTypeMap.GetMimeType(PropertyMedia.Image)};base64,{Convert.ToBase64String(PropertyMedia.FileContent)}"))"></div>
                }
                else
                {
                    if (!PropertyMedia.Image.IsNullOrEmpty())
                    {
                        <div style="width:256px;height:256px;background-size: contain;background-repeat: no-repeat; background-image:url(@($"{MimeTypes.MimeTypeMap.GetAttachmentPath()}/medias/{PropertyMedia.Image}"))"></div>
                    }
                }
            </Field>


            <Validation >
                <Field>
                    <FieldLabel>@L["Order"]</FieldLabel>
                    <NumericPicker TValue="int" @bind-Value="@PropertyMedia.Order" Decimals="0">
                        <Feedback>
                            <ValidationError />
                        </Feedback>
                    </NumericPicker>
                </Field>
            </Validation>


            <Field>
                <Check TValue="bool" @bind-Checked="@PropertyMedia.isActive">@L["IsActive"]</Check>
            </Field>
        </Validations>
    </CardBody>
    <CardFooter>
        <Button Class="btn btn-danger" Clicked="async () => await deletePropertyMediaAsync(PropertyMedia)">@L["Delete"]</Button>
    </CardFooter>



</Card>